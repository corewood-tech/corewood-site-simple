---
layout: layouts/page.njk
title: "Rootstock — Citizen Science IoT Platform & Reference Architecture for LLM-Driven Engineering"
description: "Systems thinking. Software building. Rootstock is an open-source climate tech IoT platform for citizen science and a reference architecture for LLM-driven engineering in Go. Vibe coding that scales."
keywords: "systems thinking, software building, climate tech, eco tech, environmental technology, citizen science platform, citizen science IoT, open source IoT platform, environmental monitoring, sensor data collection, campaign data collection, vibe coding, vibe coding architecture, AI engineering, LLM engineering, LLM-driven engineering, LLM-assisted development, AI code generation, scaling AI codebases, LLM context window management, AI software architecture, reference architecture LLM, Go architecture AI, GoLang, vibe coded software, Claude code, cursor architecture, agentic coding, software architecture, systems design"
ogImage: "/rootstock-meta.png"
ogType: "article"
date: 2025-02-17
permalink: /rootstock/
jsonLd: |
  {
    "@context": "https://schema.org",
    "@graph": [
      {
        "@type": "TechArticle",
        "headline": "Rootstock — Citizen Science IoT Platform & Reference Architecture for LLM-Driven Engineering",
        "description": "Systems thinking. Software building. Rootstock is an open-source climate tech IoT platform for citizen science and a reference architecture for LLM-driven engineering in Go. Vibe coding that scales.",
        "author": { "@type": "Organization", "name": "Corewood", "url": "https://corewood.io" },
        "publisher": { "@type": "Organization", "name": "Corewood", "url": "https://corewood.io" },
        "datePublished": "2025-02-17",
        "url": "https://corewood.io/rootstock/",
        "image": "https://corewood.io/rootstock-meta.png",
        "keywords": "systems thinking, software building, climate tech, eco tech, citizen science, IoT platform, environmental monitoring, vibe coding, AI engineering, LLM-driven engineering, reference architecture, Go, agentic coding, software architecture",
        "proficiencyLevel": "Expert",
        "dependencies": "Go, ConnectRPC, PostgreSQL, Minio, Zitadel, OPA, OpenTelemetry"
      },
      {
        "@type": "SoftwareSourceCode",
        "name": "Rootstock",
        "description": "Open-source climate tech platform for citizen science IoT data collection, built on a reference architecture for LLM-driven engineering. Go monorepo with Handler/Flow/Ops/Repo pattern, directional imports, and strict module conventions.",
        "codeRepository": "https://github.com/corewood-tech/rootstock",
        "programmingLanguage": "Go",
        "runtimePlatform": "Linux, macOS",
        "author": { "@type": "Organization", "name": "Corewood", "url": "https://corewood.io" }
      },
      {
        "@type": "BreadcrumbList",
        "itemListElement": [
          { "@type": "ListItem", "position": 1, "name": "Home", "item": "https://corewood.io/" },
          { "@type": "ListItem", "position": 2, "name": "Rootstock" }
        ]
      },
      {
        "@type": "FAQPage",
        "mainEntity": [
          {
            "@type": "Question",
            "name": "What is Rootstock?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Rootstock is two things: an open-source climate tech IoT platform that connects researchers with citizen-owned sensors for campaign-driven environmental monitoring, and a reference architecture for LLM-driven engineering in Go. Systems thinking, software building — the platform proves the architecture works under real conditions with multi-tenant auth, device lifecycle management, mTLS, and campaign-driven data ingestion."
            }
          },
          {
            "@type": "Question",
            "name": "Why do vibe coded projects fail at scale?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "A vibe-coded project starts fast, works well, then starts toppling under its own weight. Duplicated functions everywhere. Multiple dependencies managing the same job. The LLM gets confused, finds conflicting patterns, and stops helping. The problem is structural — the architecture has to be designed for how LLMs actually work. Rootstock provides the LLM-driven engineering patterns that make AI-generated code reliable at production scale."
            }
          },
          {
            "@type": "Question",
            "name": "What programming language is best for AI-assisted coding?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "For LLM-driven engineering, Go is the clear choice. In independent benchmarks, Go executes 3-20x faster than Python and uses 1.5-3x less memory. The performance gap means even suboptimal AI-generated Go code outperforms well-written Python. Static types catch hallucinations at compile time. That headroom makes vibe coding viable for hard problems like climate tech IoT platforms and enterprise software."
            }
          },
          {
            "@type": "Question",
            "name": "How do you manage LLM context windows when building software?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "The architecture must ensure that any given task only requires a small slice of the codebase. One module, one layer, two type files. That's all the LLM needs to see. Directional imports keep dependency trees shallow — handler imports flow, flow imports ops, ops imports repo, never the reverse."
            }
          },
          {
            "@type": "Question",
            "name": "What is the handler/flow/ops/repo architecture pattern?",
            "acceptedAnswer": {
              "@type": "Answer",
              "text": "Four layers, one direction — a software architecture pattern designed for LLM-driven engineering. Handler decouples protocol and policy. Flow orchestrates by calling one or more ops. Ops handles business rules, validation, and decisions. Repo wraps integration points like databases and identity providers. Every module has receive_types (what comes in) and emit_types (what comes out) as its contract. The strict pattern means AI code generation produces correct, consistent output every time."
            }
          }
        ]
      }
    ]
  }
---

{# ── Hero ── #}
<section class="pt-40 pb-12">
  <div class="max-w-4xl mx-auto px-6 text-center">
    <figure class="mx-auto mb-8" style="width: 80%;">
      <img src="/assets/img/rootstock.svg" alt="Rootstock reference architecture diagram" class="w-full h-auto">
    </figure>

    <h1 class="font-display font-bold text-5xl md:text-6xl text-cream-100 mb-2">Rootstock</h1>
    <p class="font-display text-xl md:text-2xl text-cream-400 mb-6">by Corewood</p>
    <p class="text-cream-200 text-lg md:text-xl max-w-2xl mx-auto mb-2"><strong class="text-cream-100">A reference architecture for LLM-driven engineering which reliably scales</strong> — and a citizen science platform that proves it works.</p>
    <p class="text-cream-300 text-lg mb-8">Open-source architecture. Real production platform. Branch out without uprooting your project.</p>

    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="https://github.com/corewood-tech/rootstock" target="_blank" rel="noopener" class="btn-primary">View the Repo &rarr;</a>
      <a href="#architecture" class="btn-secondary">Read the Architecture</a>
      <a href="#platform" class="btn-secondary">See the Platform</a>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── Intro: The Metaphor ── #}
<section class="py-16">
  <div class="max-w-3xl mx-auto px-6 text-cream-200 text-lg leading-relaxed space-y-6">
    <p>In horticulture, a rootstock refers to the established root of a fruit plant that can be grafted with limbs from other trees. Because the established root proves hearty and reliable, the branches grow from its steady supply of nutrients and solid grounding.</p>
    <p><strong class="text-cream-100">This is the missing rootstock for LLM-assisted code generation.</strong></p>
    <p>It's not a framework. It's not a specific technology. It's the basic way of thinking about a software system that you can graft onto, extend, and evolve for your needs.</p>
    <p>Rootstock serves two purposes: <strong class="text-cream-100">a reference architecture</strong> for building production software with LLMs, and <strong class="text-cream-100">a citizen science IoT platform</strong> that stress-tests every architectural decision under genuinely complex conditions. The architecture is the root. The platform is the proof.</p>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── Philosophy (pulled up) ── #}
<section class="py-16">
  <div class="max-w-3xl mx-auto px-6">
    <blockquote class="border-l-4 border-morpho-400 pl-6 py-2">
      <p class="font-display text-2xl md:text-3xl text-cream-100 leading-snug mb-4">"Most engineering decisions optimize for authoring software — trying to make writing code easier. Corewood optimizes for operations, because over time, you save money."</p>
    </blockquote>
    <p class="text-cream-200 text-lg mt-6">The question that drives every decision: <strong class="text-cream-100">What kind of system would I want to pay a team to operate?</strong></p>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── The Problem ── #}
<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <div class="section-wash">
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>
          <div class="rivet absolute bottom-7 left-7 z-10"></div>
          <div class="rivet absolute bottom-7 right-7 z-10"></div>

          <h2 class="font-display font-bold text-3xl text-cream-100 mb-6">LLMs Write Code Fast. Making It Scale Is the Hard Part.</h2>
          <div class="text-cream-200 text-lg leading-relaxed space-y-4">
            <p>You've seen it. Maybe you've lived it.</p>
            <p>A vibe-coded project starts fast, works well, then starts toppling under its own weight. Duplicated functions everywhere. Multiple dependencies managing the same job. The LLM gets confused, finds conflicting patterns, and stops helping.</p>
            <p>Even disciplined approaches break down. A well-structured Python app with models, a repository pattern, and clean modules still hits the wall — because the context window explodes with every change.</p>
            <p>Rootstock exists because this problem is <strong class="text-cream-100">structural, not skill-based</strong>. The architecture has to be designed for how LLMs actually work.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── Reference Example ── #}
<section id="platform" class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <h2 class="font-display font-bold text-3xl text-cream-100 mb-6">Reference Example: Rootstock</h2>
    <p class="text-cream-200 text-lg leading-relaxed mb-8">Rootstock isn't theoretical. We're building a complete citizen science IoT platform — called <strong class="text-cream-100">Rootstock</strong> — to demonstrate every piece of the architecture under real conditions. The full requirements specification follows the <a href="https://github.com/corewood-io/rootstock/tree/main/spec" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Volere template</a>, traced to a <a href="https://dgraph.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Dgraph</a> knowledge graph for auditability.</p>

    {# Campaign workflow diagram #}
    <figure class="mb-12">
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-6 md:p-10">
          <img src="/assets/img/campaign-flow.svg" alt="Campaign workflow: Researcher creates campaign with schema and quality bounds, Rootstock notifies matching citizen scientists, citizens submit data via phones and IoT devices, automated validation checks schema/range/rate/geolocation/anomaly, producing research-ready data with full provenance" class="w-full h-auto">
        </div>
      </div>
      <figcaption class="text-center text-cream-700 text-xs mt-3">Campaign data flow — researcher-defined schemas validate data before ingestion, eliminating cleanup</figcaption>
    </figure>

    <div class="space-y-8">
      {# The Problem #}
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mb-4">The Problem</h3>
          <div class="text-cream-200 text-lg leading-relaxed space-y-4">
            <p>Traditional scientific field data collection is expensive and structurally inadequate. Personnel costs consume 50–80% of grant budgets. Existing biodiversity datasets cover less than 7% of Earth's surface at 5km resolution. 75% of citizen science projects produce zero peer-reviewed publications — because they collect data without a specific research question.</p>
            <p>Meanwhile, 250,000+ personal weather stations (Weather Underground), 30,000+ air quality sensors (PurpleAir), and a growing market of water and soil probes are already deployed at massive scale. These are distributed mini-labs sitting idle. PurpleAir data has already been used in peer-reviewed wildfire research — the data quality is there. The coordination isn't.</p>
            <p>No platform exists that lets researchers define multi-parameter campaigns and match them to citizen-owned IoT devices.</p>
          </div>
        </div>
      </div>

      {# The Platform #}
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>
          <div class="rivet absolute bottom-7 left-7 z-10"></div>
          <div class="rivet absolute bottom-7 right-7 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mb-4">The Platform</h3>
          <div class="text-cream-200 text-lg leading-relaxed space-y-4">
            <p><strong class="text-cream-100">Researchers</strong> create data campaigns — structured requests specifying what sensor data they need, where, when, and to what quality standard. The campaign model inverts the typical citizen science flow: instead of "collect data and hope researchers use it," researchers define what they need first.</p>
            <p><strong class="text-cream-100">Scitizens</strong> — our term for citizen scientists — discover campaigns relevant to their location and equipment, enroll their IoT devices, and contribute readings. Devices submit data automatically after enrollment, fundamentally changing the retention equation.</p>
            <p><strong class="text-cream-100">Devices</strong> are untrusted. Every sensor reading crosses a trust boundary. The platform authenticates via mTLS with a self-operated certificate authority, authorizes via <a href="https://www.openpolicyagent.org/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">OPA</a> against a device registry, and validates every reading against campaign-defined quality thresholds — schema, range, rate, geolocation, anomaly detection. Quarantined readings are never deleted.</p>
            <p><strong class="text-cream-100">Data</strong> is exported with full provenance metadata, quality metrics, and campaign context — meeting <a href="https://www.go-fair.org/fair-principles/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">FAIR principles</a> so the data is actually publishable. Contributor identity is separated from observation data. Raw contributor locations never appear in public-facing datasets.</p>
          </div>
        </div>
      </div>

      {# What This Exercises #}
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mb-4">What This Exercises</h3>
          <p class="text-cream-200 text-lg mb-4">This isn't a demo app. It's a platform with:</p>
          <ul class="text-cream-200 text-lg leading-relaxed space-y-2">
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">Multi-tenant hierarchical authorization</strong> — institutions contain departments contain labs, roles are org-scoped, OPA enforces everything</span></li>
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">IoT device lifecycle management</strong> — enrollment codes, CSR-based certificate issuance, 90-day cert rotation, automated renewal, bulk revocation</span></li>
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">mTLS device authentication</strong> — two-tier CA hierarchy, device registry as source of truth</span></li>
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">Campaign-driven data ingestion</strong> — schema validation, range checks, cross-device correlation, anomaly flagging</span></li>
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">Cross-org participation</strong> — scitizens have no institutional affiliation with the requesting researcher</span></li>
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">Privacy architecture</strong> — GDPR-compliant consent model, granular per-campaign permissions, configurable spatial resolution</span></li>
            <li class="flex gap-3"><span class="text-morpho-500 mt-1.5 flex-shrink-0">&#x2022;</span><span><strong class="text-cream-100">Full observability from day one</strong> — <a href="https://opentelemetry.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">OpenTelemetry</a> traces, metrics, and structured logs flowing through a collector to <a href="https://prometheus.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Prometheus</a>, <a href="https://grafana.com/oss/tempo/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Tempo</a>, <a href="https://grafana.com/oss/loki/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Loki</a>, and <a href="https://grafana.com/oss/grafana/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Grafana</a> dashboards</span></li>
          </ul>
          <p class="text-cream-300 text-lg mt-6"><strong class="text-cream-100">Not a todo app. Not a demo.</strong> A platform that solves the last-mile problem between researchers and the data they need.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── We Shipped It ── #}
<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <div class="section-wash">
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>
          <div class="rivet absolute bottom-7 left-7 z-10"></div>
          <div class="rivet absolute bottom-7 right-7 z-10"></div>

          <h2 class="font-display font-bold text-3xl text-cream-100 mb-6">We Didn't Theorize This. We Shipped It.</h2>
          <div class="text-cream-200 text-lg leading-relaxed space-y-4">
            <p>Corewood built <a href="https://app.landscope.earth" class="text-morpho-400 hover:text-morpho-300 transition-colors">LandScope</a> with CEO <a href="https://mitch.earth" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Mitch Rawlyk</a> — a terrain intelligence platform used by land professionals across the world. Enterprise authentication. SSO/SAML integration. <a href="https://www.openpolicyagent.org/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">OPA</a>-driven permissions. <a href="https://opentelemetry.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">OpenTelemetry</a> from day one. 291,000+ acres mapped and counting.</p>
            <p>We also built LLM inference engines, complex Postgres wire protocol interceptions, and a bunch of websites.</p>
            <p>Then we asked: what if we open-sourced the architecture that made all of it possible?</p>
          </div>
          <blockquote class="border-l-4 border-morpho-400 pl-6 py-2 mt-6">
            <p class="text-cream-100 text-lg leading-snug">Most engineering decisions optimize for authoring software — trying to make writing code easier. Corewood optimizes for operations, because over time, you save money.</p>
          </blockquote>
          <p class="text-cream-200 text-lg mt-6"><strong class="text-cream-100">Rootstock is the answer. Use it free. Or <a href="{{ '/schedule-meeting/' | url }}" class="text-morpho-400 hover:text-morpho-300 transition-colors">hire us</a> to build yours.</strong></p>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── Two Lessons ── #}
<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <h2 class="font-display font-bold text-3xl text-cream-100 mb-4">Two Lessons That Changed Everything</h2>
    <p class="text-cream-200 text-lg leading-relaxed mb-12"><strong class="text-cream-100">Corewood spent ~11 months learning this the hard way</strong> — building production software, yelling at the LLM, and refining the patterns that actually hold up. Rootstock is everything we learned, open-sourced.</p>

    <div class="space-y-8">
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mb-4">1. Manage Context Windows</h3>
          <div class="text-cream-200 text-lg leading-relaxed space-y-4">
            <p>Context windows are the bottleneck. LLMs effectively work at smaller scale, but as the application grows it buckles under its own weight. The LLMs get confused, find multiple patterns to follow, and ultimately fail to help your project grow.</p>
            <p>Rootstock's architecture keeps every task small and self-contained. The LLM never needs to reason about the whole system.</p>
          </div>
        </div>
      </div>

      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mb-4">2. Follow Strict Patterns</h3>
          <div class="text-cream-200 text-lg leading-relaxed space-y-4">
            <p>Every choice you give the LLM is a risk to the stability of the project. Don't give it more choices than absolutely necessary.</p>
            <p>Rootstock uses identical file names, identical structure, identical conventions across every module. The LLM copies the nearest neighbor — and it works every time.</p>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{# ── Inline CTA ── #}
<section class="py-12">
  <div class="max-w-3xl mx-auto px-6 text-center">
    <p class="text-cream-300 text-lg mb-6">Want to apply these lessons to your codebase?</p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="{{ '/schedule-meeting/' | url }}" class="btn-primary">Talk to a Corewood Engineer &rarr;</a>
      <a href="#architecture" class="btn-secondary">Read the Architecture</a>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── Three Principles ── #}
<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <h2 class="font-display font-bold text-3xl text-cream-100 mb-12">The Three Principles</h2>

    <div class="grid md:grid-cols-3 gap-6">
      <div class="plate-wrap">
        <div class="plate chamfer-full p-6">
          <div class="rivet absolute top-4 left-4 z-10"></div>
          <div class="rivet absolute top-4 right-4 z-10"></div>

          <h3 class="font-display font-bold text-xl text-cream-100 mt-2 mb-3">Use Performant Languages</h3>
          <p class="text-cream-200 leading-relaxed">LLM-generated code won't be perfect. Give it a runtime where imperfect code still performs.</p>
          <p class="text-cream-300 leading-relaxed mt-3">In independent benchmarks, Go executes 3–20x faster than Python and uses 1.5–3x less memory across typical workloads. The performance gap is wide enough that even suboptimal Go code routinely outperforms well-written Python. That headroom is what makes LLM-assisted coding viable at scale.</p>
        </div>
      </div>

      <div class="plate-wrap">
        <div class="plate chamfer-full p-6">
          <div class="rivet absolute top-4 left-4 z-10"></div>
          <div class="rivet absolute top-4 right-4 z-10"></div>

          <h3 class="font-display font-bold text-xl text-cream-100 mt-2 mb-3">Definite, Reproducible Patterns</h3>
          <p class="text-cream-200 leading-relaxed">LLMs are pattern completion machines. Give them patterns that repeat identically — same file names, same structure, same conventions across every module. The LLM copies the nearest neighbor. The more consistent the pattern, the more reliable the output.</p>
        </div>
      </div>

      <div class="plate-wrap">
        <div class="plate chamfer-full p-6">
          <div class="rivet absolute top-4 left-4 z-10"></div>
          <div class="rivet absolute top-4 right-4 z-10"></div>

          <h3 class="font-display font-bold text-xl text-cream-100 mt-2 mb-3">Keep Context Small Per-Task</h3>
          <p class="text-cream-200 leading-relaxed">The context window is the hard limit. The architecture must ensure that any given task only requires a small slice of the codebase. One module, one layer, two type files. That's all the LLM needs to see.</p>
        </div>
      </div>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── The Architecture ── #}
<section id="architecture" class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <div class="section-wash">
      <div class="plate-wrap">
        <div class="plate chamfer-full-lg p-8 md:p-12">
          <div class="rivet absolute top-7 left-7 z-10"></div>
          <div class="rivet absolute top-7 right-7 z-10"></div>
          <div class="rivet absolute bottom-7 left-7 z-10"></div>
          <div class="rivet absolute bottom-7 right-7 z-10"></div>

          <h2 class="font-display font-bold text-3xl text-cream-100 mb-4">The Architecture</h2>
          <p class="text-cream-200 text-lg mb-8">Four layers. One direction. Every module follows the same shape.</p>

          <div class="text-cream-200 text-lg leading-relaxed space-y-6">
            <div class="bg-forest-800/50 border border-forest-600/30 rounded-lg p-6">
              <p class="text-cream-100 font-display font-bold text-xl mb-2">Handler → Auth → Flow → Ops → Repo</p>
            </div>

            <figure class="my-8">
              <img src="/assets/img/pipeline.svg" alt="Request pipeline diagram: RPC → Handler → Auth → Flow → Ops → Repo, with unauthorized requests dropped at the Auth boundary" class="w-full h-auto">
            </figure>

            <div>
              <h3 class="font-display font-bold text-xl text-cream-100 mb-2">Handler</h3>
              <p>Decouples protocol and policy. Translates wire format to application types. Runs auth before anything else.</p>
            </div>

            <div>
              <h3 class="font-display font-bold text-xl text-cream-100 mb-2">Auth</h3>
              <p>A sub-flow at the edge. Identity and authorization are resolved through globals that delegate to repos. Vendors are implementation details hidden behind interfaces. Unauthorized requests are dropped here — they never reach business logic. Auth-derived data (user ID, roles) is passed explicitly into the flow request. Clean contract. No side-channel dependencies.</p>
            </div>

            <div>
              <h3 class="font-display font-bold text-xl text-cream-100 mb-2">Flow</h3>
              <p>Orchestrates. Calls one or more ops, converts between layer types. Thin by design.</p>
            </div>

            <div>
              <h3 class="font-display font-bold text-xl text-cream-100 mb-2">Ops</h3>
              <p>Does the things. Business rules, validation, decisions. The fat layer.</p>
            </div>

            <div>
              <h3 class="font-display font-bold text-xl text-cream-100 mb-2">Repo</h3>
              <p>Handles integration points. Any external boundary — database, identity provider, object store. Hides provider-specific details behind a clean interface.</p>
            </div>

            <div class="bg-forest-800/50 border border-forest-600/30 rounded-lg p-6 mt-6">
              <h3 class="font-display font-bold text-lg text-cream-100 mb-3">The Module Convention</h3>
              <p class="text-cream-200 mb-4">Every module at every layer has exactly two type files:</p>
              <ul class="text-cream-300 space-y-1 mb-4">
                <li><strong class="text-cream-100">receive_types</strong> — what comes in</li>
                <li><strong class="text-cream-100">emit_types</strong> — what comes out</li>
              </ul>
              <p class="text-cream-400 text-sm">That's the contract. That's the entire surface area. If you know the inputs and outputs, you know the module. The LLM knows the module.</p>
            </div>

            <div class="bg-forest-800/50 border border-forest-600/30 rounded-lg p-6">
              <h3 class="font-display font-bold text-lg text-cream-100 mb-3">Directional Imports</h3>
              <p class="text-cream-200 mb-2">Imports only go inward. Handler imports flow. Flow imports ops. Ops imports repo. Never the reverse.</p>
              <p class="text-cream-300">The innermost layers are the most stable. The outermost layer absorbs all protocol changes without rippling inward. Circular dependencies are structurally impossible.</p>
            </div>

            <div class="bg-forest-800/50 border border-forest-600/30 rounded-lg p-6">
              <h3 class="font-display font-bold text-lg text-cream-100 mb-3">Globals and Vendor Obfuscation</h3>
              <p class="text-cream-200 mb-2">Cross-cutting concerns — observability, events, auth — live in <code class="bg-forest-800 text-cream-200 px-1.5 py-0.5 rounded text-sm">global/</code>. Each global is a thin singleton accessor that delegates to a repo. The repo wraps the vendor. The global knows nothing about the vendor. Swap <a href="https://opentelemetry.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">OpenTelemetry</a> for Datadog, swap <a href="https://zitadel.com/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Zitadel</a> for Auth0 — one repo changes, everything else stays the same.</p>
              <p class="text-cream-300">This is <a href="https://www.informit.com/articles/article.aspx?p=2995357&amp;seqNum=2" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">volatility-based decomposition</a>: things that change independently are isolated behind separate boundaries. <a href="https://blog.cleancoder.com/uncle-bob/2012/08/13/the-clean-architecture.html" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Clean Architecture</a> governs the direction: dependencies always point inward.</p>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

{# ── Inline CTA ── #}
<section class="py-12">
  <div class="max-w-3xl mx-auto px-6 text-center">
    <p class="text-cream-300 text-lg mb-6">See these patterns applied to a real codebase.</p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="https://github.com/corewood-tech/rootstock" target="_blank" rel="noopener" class="btn-primary">GitHub: Rootstock &rarr;</a>
      <a href="#follow" class="btn-secondary">Follow the Build</a>
    </div>
  </div>
</section>

<div class="max-w-3xl mx-auto px-6"><div class="section-divider"></div></div>

{# ── The Stack ── #}
<section class="py-16">
  <div class="max-w-4xl mx-auto px-6">
    <h2 class="font-display font-bold text-3xl text-cream-100 mb-8">The Stack</h2>

    <div class="plate-wrap">
      <div class="plate chamfer-full-lg p-8 md:p-12">
        <div class="rivet absolute top-7 left-7 z-10"></div>
        <div class="rivet absolute top-7 right-7 z-10"></div>
        <div class="rivet absolute bottom-7 left-7 z-10"></div>
        <div class="rivet absolute bottom-7 right-7 z-10"></div>

        <div class="overflow-x-auto">
          <table class="w-full text-left">
            <thead>
              <tr class="border-b border-forest-600/30">
                <th class="text-cream-100 font-display font-bold text-sm uppercase tracking-wider pb-3 pr-6">Layer</th>
                <th class="text-cream-100 font-display font-bold text-sm uppercase tracking-wider pb-3 pr-6">Choice</th>
                <th class="text-cream-100 font-display font-bold text-sm uppercase tracking-wider pb-3">Why</th>
              </tr>
            </thead>
            <tbody class="text-cream-200">
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Backend</td>
                <td class="py-3 pr-6">Go</td>
                <td class="py-3 text-cream-300">Performance headroom, concurrency, ops-focused ecosystem, CGo for C interop</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Frontend</td>
                <td class="py-3 pr-6">Svelte + SvelteKit</td>
                <td class="py-3 text-cream-300">Compiles to static assets. No server runtime.</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">API Protocol</td>
                <td class="py-3 pr-6">ConnectRPC</td>
                <td class="py-3 text-cream-300">Typed contracts from protos, codegen both sides, works over HTTP/1.1</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Database</td>
                <td class="py-3 pr-6">PostgreSQL</td>
                <td class="py-3 text-cream-300">Handles almost everything. Boring. Proven.</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Object Store</td>
                <td class="py-3 pr-6">Minio</td>
                <td class="py-3 text-cream-300">S3-compatible, runs as a container, full dev/prod parity</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Identity</td>
                <td class="py-3 pr-6">Zitadel</td>
                <td class="py-3 text-cream-300">SessionAPI only — isolated behind repo pattern, provider doesn't leak</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Authorization</td>
                <td class="py-3 pr-6">OPA</td>
                <td class="py-3 text-cream-300">Policies as data, evaluated in-process, recompiled on state changes</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Observability</td>
                <td class="py-3 pr-6">OpenTelemetry</td>
                <td class="py-3 text-cream-300">Tracing, structured logging, metrics from day one</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Workflow Engine</td>
                <td class="py-3 pr-6"><a href="https://dbos.dev/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">DBOS</a></td>
                <td class="py-3 text-cream-300">Durable execution for long-running processes</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Reverse Proxy</td>
                <td class="py-3 pr-6"><a href="https://caddyserver.com/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Caddy</a></td>
                <td class="py-3 text-cream-300">Automatic TLS, config-driven routing</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Containers</td>
                <td class="py-3 pr-6"><a href="https://podman.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Podman</a> Compose</td>
                <td class="py-3 text-cream-300">Dev parity with production. Dependencies live in the container, not on your machine.</td>
              </tr>
              <tr class="border-b border-forest-700/30">
                <td class="py-3 pr-6 font-bold text-cream-100">Testing</td>
                <td class="py-3 pr-6">Playwright</td>
                <td class="py-3 text-cream-300">End-to-end stability and automated verifiability</td>
              </tr>
              <tr>
                <td class="py-3 pr-6 font-bold text-cream-100">Config</td>
                <td class="py-3 pr-6"><a href="https://github.com/knadh/koanf" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">koanf</a></td>
                <td class="py-3 text-cream-300">Defaults → YAML → env vars → CLI flags. Resolved once at startup.</td>
              </tr>
            </tbody>
          </table>
        </div>

        <p class="text-cream-400 text-sm mt-6">Every choice reduces the number of things the LLM has to guess about.</p>
      </div>
    </div>
  </div>
</section>

{# ── Inline CTA ── #}
<section class="py-12">
  <div class="max-w-3xl mx-auto px-6 text-center">
    <p class="text-cream-300 text-lg mb-6">Every choice reduces the number of things the LLM has to guess about.</p>
    <div class="flex flex-col sm:flex-row gap-4 justify-center">
      <a href="https://github.com/corewood-tech/rootstock" target="_blank" rel="noopener" class="btn-primary">View the Repo &rarr;</a>
      <a href="{{ '/schedule-meeting/' | url }}" class="btn-secondary">Talk to Us</a>
    </div>
  </div>
</section>

{# ── Two Ways Forward ── #}
<section id="follow" class="py-16 pb-24">
  <div class="max-w-4xl mx-auto px-6">
    <h2 class="font-display font-bold text-3xl md:text-4xl text-cream-100 mb-12 text-center">Two Ways Forward</h2>

    <div class="grid md:grid-cols-2 gap-8">
      <div class="plate-wrap">
        <div class="plate chamfer-full p-8">
          <div class="rivet absolute top-4 left-4 z-10"></div>
          <div class="rivet absolute top-4 right-4 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mt-2 mb-4">Use Rootstock</h3>
          <div class="text-cream-200 leading-relaxed space-y-4 mb-6">
            <p>The architecture, the patterns, the stack — all open source under a BSD 3-Clause license. Clone it, learn from it, graft your own project onto it.</p>
            <p><code class="bg-forest-800 text-cream-200 px-1.5 py-0.5 rounded text-sm">make up</code> starts the full stack: web server with hot reload, PostgreSQL, Zitadel, OPA, OpenTelemetry, Prometheus, Grafana, Caddy. Everything runs in containers. The only prerequisite is <a href="https://podman.io/" class="text-morpho-400 hover:text-morpho-300 transition-colors" target="_blank" rel="noopener">Podman</a>.</p>
            <p>Rootstock gives you the foundation. You build the branches.</p>
          </div>
          <a href="https://github.com/corewood-tech/rootstock" target="_blank" rel="noopener" class="btn-primary">GitHub: Rootstock &rarr;</a>
        </div>
      </div>

      <div class="plate-wrap">
        <div class="plate chamfer-full p-8">
          <div class="rivet absolute top-4 left-4 z-10"></div>
          <div class="rivet absolute top-4 right-4 z-10"></div>

          <h3 class="font-display font-bold text-2xl text-cream-100 mt-2 mb-4">Hire Corewood</h3>
          <div class="text-cream-200 leading-relaxed space-y-4 mb-6">
            <p>You have a real problem. You need software that handles user data, credit cards, enterprise auth, and doesn't fall apart at 2am.</p>
            <p>We've built this before. We'll build it with you.</p>
            <p>Corewood brings the same architecture, the same patterns, the same production-first mindset — applied to your problem, your domain, your timeline.</p>
          </div>
          <div class="flex flex-col sm:flex-row gap-3">
            <a href="{{ '/schedule-meeting/' | url }}" class="btn-primary">Schedule a Consultation &rarr;</a>
            <a href="{{ '/contact/' | url }}" class="btn-secondary">Contact Us</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>
